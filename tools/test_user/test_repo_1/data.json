{
  "pulls": [
    {
      "number": 1,
      "id": 1,
      "node_id": "PR_kwDOTest1",
      "state": "open",
      "title": "Add new feature for user authentication",
      "body": "This PR implements JWT-based authentication for the API.\n\n## Changes\n- Added JWT middleware\n- Updated user model\n- Added authentication tests",
      "created_at": "2024-01-15T10:30:00Z",
      "updated_at": "2024-01-15T14:20:00Z",
      "closed_at": null,
      "merged_at": null,
      "user": {
        "login": "developer1",
        "id": 101,
        "type": "User",
        "avatar_url": "https://avatars.githubusercontent.com/u/101?v=4"
      },
      "head": {
        "ref": "feature/auth",
        "sha": "abc123def456",
        "repo": {
          "name": "test_repo_1",
          "owner": {
            "login": "test_user"
          }
        }
      },
      "base": {
        "ref": "main",
        "sha": "def789ghi012",
        "repo": {
          "name": "test_repo_1",
          "owner": {
            "login": "test_user"
          }
        }
      },
      "draft": false,
      "merged": false,
      "mergeable": true,
      "mergeable_state": "clean",
      "comments": 3,
      "review_comments": 2,
      "commits": 5,
      "additions": 156,
      "deletions": 42,
      "changed_files": 2
    },
    {
      "number": 2,
      "id": 2,
      "node_id": "PR_kwDOTest2",
      "state": "open",
      "title": "Fix critical bug in payment processing system that was causing duplicate charges and race conditions when multiple concurrent requests were submitted by the same user within a short time window",
      "body": "Fixes #42\n\nThis PR resolves the race condition in the payment processor that was causing duplicate charges.",
      "created_at": "2024-01-16T09:00:00Z",
      "updated_at": "2024-01-16T15:45:00Z",
      "closed_at": null,
      "merged_at": null,
      "user": {
        "login": "developer2",
        "id": 102,
        "type": "User",
        "avatar_url": "https://avatars.githubusercontent.com/u/102?v=4"
      },
      "head": {
        "ref": "fix/payment-race-condition",
        "sha": "xyz789abc123",
        "repo": {
          "name": "test_repo_1",
          "owner": {
            "login": "test_user"
          }
        }
      },
      "base": {
        "ref": "main",
        "sha": "def789ghi012",
        "repo": {
          "name": "test_repo_1",
          "owner": {
            "login": "test_user"
          }
        }
      },
      "draft": false,
      "merged": false,
      "mergeable": true,
      "mergeable_state": "unstable",
      "comments": 5,
      "review_comments": 4,
      "commits": 3,
      "additions": 45,
      "deletions": 38,
      "changed_files": 3
    }
  ],
  "comments": [
    {
      "id": 1001,
      "pull_number": 1,
      "diff_hunk": "@@ -10,7 +10,12 @@ export const authenticate = async (req, res, next) => {\n   const token = req.headers.authorization;\n-  if (!token) {\n-    return res.status(401).json({ error: 'No token provided' });\n+  if (!token || !token.startsWith('Bearer ')) {\n+    return res.status(401).json({ \n+      error: 'No token provided',\n+      message: 'Authorization header must include Bearer token'\n+    });",
      "path": "example.js",
      "position": 5,
      "original_position": 5,
      "commit_id": "abc123def456",
      "original_commit_id": "abc123def456",
      "user": {
        "login": "reviewer1",
        "id": 201,
        "type": "User"
      },
      "body": "Good improvement! Consider also validating the token format before attempting to verify it.",
      "created_at": "2024-01-15T11:00:00Z",
      "updated_at": "2024-01-15T11:00:00Z",
      "html_url": "https://github.com/test_user/test_repo_1/pull/1#discussion_r1001",
      "pull_request_url": "https://api.github.com/repos/test_user/test_repo_1/pulls/1",
      "line": 15,
      "side": "RIGHT",
      "start_line": null,
      "start_side": null,
      "in_reply_to_id": null
    },
    {
      "id": 1002,
      "pull_number": 1,
      "diff_hunk": "@@ -25,6 +30,8 @@ export const authenticate = async (req, res, next) => {\n   try {\n     const decoded = jwt.verify(token, process.env.JWT_SECRET);\n     req.user = decoded;\n+    req.authenticated = true;\n+    req.authTime = Date.now();",
      "path": "example.cs",
      "position": 8,
      "original_position": 8,
      "commit_id": "abc123def456",
      "original_commit_id": "abc123def456",
      "user": {
        "login": "reviewer1",
        "id": 201,
        "type": "User"
      },
      "body": "Is `authTime` being used anywhere? If not, consider removing it to keep the middleware lean.",
      "created_at": "2024-01-15T12:30:00Z",
      "updated_at": "2024-01-15T12:30:00Z",
      "html_url": "https://github.com/test_user/test_repo_1/pull/1#discussion_r1002",
      "pull_request_url": "https://api.github.com/repos/test_user/test_repo_1/pulls/1",
      "line": 32,
      "side": "RIGHT",
      "start_line": 31,
      "start_side": "RIGHT",
      "in_reply_to_id": null
    },
    {
      "id": 2001,
      "pull_number": 2,
      "diff_hunk": "@@ -45,10 +45,15 @@ async function processPayment(userId, amount) {\n-  const payment = await Payment.create({\n-    userId,\n-    amount,\n-    status: 'pending'\n-  });\n+  const existingPayment = await Payment.findOne({\n+    where: { userId, amount, status: 'pending' }\n+  });\n+  \n+  if (existingPayment) {\n+    return existingPayment;\n+  }\n+  \n+  const payment = await Payment.create({ userId, amount, status: 'pending' });",
      "path": "example.cs",
      "position": 12,
      "original_position": 12,
      "commit_id": "xyz789abc123",
      "original_commit_id": "xyz789abc123",
      "user": {
        "login": "reviewer1",
        "id": 201,
        "type": "User"
      },
      "body": "This looks good, but we should add a transaction here to ensure atomicity. What if two requests check at the same time?",
      "created_at": "2024-01-16T10:15:00Z",
      "updated_at": "2024-01-16T10:15:00Z",
      "html_url": "https://github.com/test_user/test_repo_1/pull/2#discussion_r2001",
      "pull_request_url": "https://api.github.com/repos/test_user/test_repo_1/pulls/2",
      "line": 52,
      "side": "RIGHT",
      "start_line": 48,
      "start_side": "RIGHT",
      "in_reply_to_id": null
    },
    {
      "id": 4001,
      "pull_number": 1,
      "diff_hunk": "@@ -1,5 +1,8 @@\n function hello() {\n   console.log(\"Hello, world!\");\n+  console.log(\"This is a test\");\n }",
      "path": "example.js",
      "position": 3,
      "original_position": 3,
      "commit_id": "abc123def456",
      "original_commit_id": "abc123def456",
      "pull_request_review_id": 6001,
      "user": {
        "login": "reviewer1",
        "id": 201,
        "type": "User"
      },
      "body": "Pending comment on app.js",
      "created_at": "2024-01-15T12:00:00Z",
      "updated_at": "2024-01-15T12:00:00Z",
      "html_url": "https://github.com/test_user/test_repo_1/pull/1#discussion_r4001",
      "pull_request_url": "https://api.github.com/repos/test_user/test_repo_1/pulls/1",
      "line": 4,
      "side": "RIGHT",
      "start_line": null,
      "start_side": null,
      "in_reply_to_id": null
    }
  ],
  "reviews": [
    {
      "id": 6001,
      "node_id": "PRR_6001",
      "pull_number": 1,
      "user": {
        "login": "reviewer1",
        "id": 201,
        "node_id": "U_kgDOReviewer1",
        "avatar_url": "https://avatars.githubusercontent.com/u/201?v=4",
        "type": "User"
      },
      "body": "",
      "state": "PENDING",
      "html_url": "https://github.com/test_user/test_repo_1/pull/1#pullrequestreview-6001",
      "pull_request_url": "https://api.github.com/repos/test_user/test_repo_1/pulls/1",
      "_links": {
        "html": {
          "href": "https://github.com/test_user/test_repo_1/pull/1#pullrequestreview-6001"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/test_user/test_repo_1/pulls/1"
        }
      },
      "commit_id": "abc123def456",
      "author_association": "OWNER"
    }
  ],
  "reviewThreads": [
    {
      "pull_number": 1,
      "id": "PRT_kwDOThread1001",
      "isResolved": false,
      "isOutdated": false,
      "isCollapsed": false,
      "path": "example.js",
      "originalLine": 15,
      "line": 15,
      "comments": [
        {
          "id": "PRRC_kwDO1001",
          "databaseId": 1001,
          "body": "Good improvement! Consider also validating the token format before attempting to verify it.",
          "path": "example.js",
          "line": 15,
          "startLine": null,
          "diffHunk": "@@ -10,7 +10,12 @@ export const authenticate = async (req, res, next) => {\n   const token = req.headers.authorization;\n-  if (!token) {\n-    return res.status(401).json({ error: 'No token provided' });\n+  if (!token || !token.startsWith('Bearer ')) {\n+    return res.status(401).json({ \n+      error: 'No token provided',\n+      message: 'Authorization header must include Bearer token'\n+    });",
          "createdAt": "2024-01-15T11:00:00Z",
          "updatedAt": "2024-01-15T11:00:00Z",
          "author": {
            "login": "reviewer1"
          },
          "pullRequestReview": {
            "id": "PRR_6002",
            "state": "COMMENTED"
          }
        }
      ]
    },
    {
      "pull_number": 1,
      "id": "PRT_kwDOThread1002",
      "isResolved": false,
      "isOutdated": false,
      "isCollapsed": false,
      "path": "example.cs",
      "originalLine": 32,
      "line": 32,
      "comments": [
        {
          "id": "PRRC_kwDO1002",
          "databaseId": 1002,
          "body": "Is `authTime` being used anywhere? If not, consider removing it to keep the middleware lean.",
          "path": "example.cs",
          "line": 32,
          "startLine": 31,
          "diffHunk": "@@ -25,6 +30,8 @@ export const authenticate = async (req, res, next) => {\n   try {\n     const decoded = jwt.verify(token, process.env.JWT_SECRET);\n     req.user = decoded;\n+    req.authenticated = true;\n+    req.authTime = Date.now();",
          "createdAt": "2024-01-15T12:30:00Z",
          "updatedAt": "2024-01-15T12:30:00Z",
          "author": {
            "login": "reviewer1"
          },
          "pullRequestReview": {
            "id": "PRR_6002",
            "state": "COMMENTED"
          }
        }
      ]
    },
    {
      "pull_number": 1,
      "id": "PRT_kwDOThread4001",
      "isResolved": false,
      "isOutdated": false,
      "isCollapsed": false,
      "path": "example.js",
      "originalLine": 4,
      "line": 4,
      "comments": [
        {
          "id": "PRRC_kwDO4001",
          "databaseId": 4001,
          "body": "Pending comment on app.js",
          "path": "example.js",
          "line": 4,
          "startLine": null,
          "diffHunk": "@@ -1,5 +1,8 @@\n function hello() {\n   console.log(\"Hello, world!\");\n+  console.log(\"This is a test\");\n }",
          "createdAt": "2024-01-15T12:00:00Z",
          "updatedAt": "2024-01-15T12:00:00Z",
          "author": {
            "login": "reviewer1"
          },
          "pullRequestReview": {
            "id": "PRR_6001",
            "state": "PENDING"
          }
        }
      ]
    },
    {
      "pull_number": 2,
      "id": "PRT_kwDOThread2001",
      "isResolved": false,
      "isOutdated": false,
      "isCollapsed": false,
      "path": "example.cs",
      "originalLine": 52,
      "line": 52,
      "comments": [
        {
          "id": "PRRC_kwDO2001",
          "databaseId": 2001,
          "body": "This looks good, but we should add a transaction here to ensure atomicity. What if two requests check at the same time?",
          "path": "example.cs",
          "line": 52,
          "startLine": 48,
          "diffHunk": "@@ -45,10 +45,15 @@ async function processPayment(userId, amount) {\n-  const payment = await Payment.create({\n-    userId,\n-    amount,\n-    status: 'pending'\n-  });\n+  const existingPayment = await Payment.findOne({\n+    where: { userId, amount, status: 'pending' }\n+  });\n+  \n+  if (existingPayment) {\n+    return existingPayment;\n+  }\n+  \n+  const payment = await Payment.create({ userId, amount, status: 'pending' });",
          "createdAt": "2024-01-16T10:15:00Z",
          "updatedAt": "2024-01-16T10:15:00Z",
          "author": {
            "login": "reviewer1"
          },
          "pullRequestReview": {
            "id": "PRR_6003",
            "state": "COMMENTED"
          }
        }
      ]
    }
  ]
}
